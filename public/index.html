<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Burger Connoisseur</title>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
  </head>

  <body>
    <div class="container col" style="display:flex; background-color:lightblue">
      <div class="col-sm-4">
        <h1>My Burger Bucket List</h1>
        <ul id="wishlist"></ul>
      </div>
      ​
      <div class="col-sm-4">
        <h2>Add Burger to Wish List</h2>
        <input id="addBurgerName" type="text" /><button
          id="addBurger"
          onClick="saveBurger()"
        >
          Add Burger!
        </button>
      </div>
      ​
      <div class="col-sm-4">
        <h1>Burgers Consumed</h1>
        <ul id="consumed"></ul>
      </div>
    </div>
    <div>
      <h3>
        <input
          id="addResultMsg"
          class="col center"
          type="text"
          style="display:flex; flex-direction: row; background-color: inherit; border:none"
          value=""
          readonly
        />
      </h3>
    </div>
    ​
    <!-- <script src="../server.js"></script> -->
    <script>
      var wishArray = [];
      function listWishList() {
        console.log(`.. listing bucket list`);
        $.ajax({
          url: `/burgers`,
          type: "GET",
          success: function(result) {
            console.log("Success");
            console.log(result);
            result.forEach(burger => {
              wishArray.push(burger.burger);
              $("#wishlist").append(
                `<li id="wishlist${burger.burger}"><div style="justify-content: space-between">${burger.burger} <button id="${burger.burger}" value = "${burger.burger}" onClick="consumeBurger("${burger.burger}")">Devour it!</button></div></li>`
              );
            });
          }
        });
      }

      function listConsumed() {
        console.log(`.. listing consumed list`);
        $.ajax({
          url: `/consumed`,
          type: "GET",
          success: function(result) {
            console.log("Success");
            result.forEach(burger => {
              wishArray.push(burger.burger);
              $("#consumed").append(
                `<li id="consumed${burger.burger}"><div style="justify-content: space-between">${burger.burger} <button value = "${burger.burger}" onClick="deleteBurger(${burger.burger})"">Delete!</button></div></li>`
              );
            });
          }
        });
      }

      function saveBurger() {
        const burgerName = $("#addBurgerName")
          .val()
          .trim();
        $("#addBurgerName").val("");
        console.log(wishArray.indexOf(burgerName));
        if (wishArray.indexOf(burgerName) == -1) {
          console.log(`.. adding ${burgerName} to bucket list`);
          $.ajax({
            url: `/api/burgers/wishlist/${burgerName}`,
            type: "POST",
            success: function(result) {
              console.log("Success");
              wishArray.push(result.burger);
              $("#wishlist").append(
                `<li id="wishlist${result.burger}">${result.burger} <button value = "${result.id}"" onClick="consumeBurger(${result.burger})">Devour it!</button></li>`
              );
            }
          });
        } else {
          $(`#addResultMsg`).val(
            "This burger was already added to wishlist or consumed!!"
          );
        }
      }

      function consumeBurger(burgerName) {
        console.log(`.. adding to consumed list`);
        $.ajax({
          url: `/api/burgers/consumed/${burgerName}`,
          type: "POST",
          success: function(result) {
            console.log("Success " + result);
            $(`#wishlist${burgerName}`).remove();
            $("#consumed").append(
              `<li id="consumed${result.id}">${result.burger} <button value = ${result.id} onClick="deleteBurger()">Delete!</button></li>`
            );
            // $(`#wishlist${burgerid}`).remove();
          }
        });
      }

      $(document).ready(function() {
        console.log(`Running our code`);
        listWishList();
        listConsumed();
      });
    </script>
  </body>
</html>
